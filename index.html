<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>记忆代理人 - 传说武器锻造台</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=DotGothic16&family=Press+Start+2P&display=swap" rel="stylesheet"><style>:root{--bg-color:#1a1a1a;--panel-bg:#2b2b2b;--border-color:#555;--accent-color:#a855f7;--gold-color:#fbbf24;--text-color:#e5e5e5;--mc-tooltip-bg:rgba(16, 0, 16, 0.95);--mc-border:#2a002a}*{box-sizing:border-box;margin:0;padding:0}body{font-family:DotGothic16,'Segoe UI','Microsoft YaHei',sans-serif;background-color:var(--bg-color);background-image:url('https://assets.codepen.io/13471/dark-texture.png');color:var(--text-color);display:flex;flex-direction:column;align-items:center;min-height:100vh;padding:20px}h1{font-family:DotGothic16,sans-serif;color:#38bdf8;text-shadow:4px 4px 0 #0f4c75;margin-bottom:10px;text-align:center;line-height:1.5;font-size:3rem;letter-spacing:2px}.subtitle{color:#888;margin-bottom:30px;font-size:.9rem}.container{display:grid;grid-template-columns:1fr 400px;gap:30px;width:100%;max-width:1200px}.config-panel{background:var(--panel-bg);border:2px solid var(--border-color);padding:20px;border-radius:4px;box-shadow:0 10px 30px rgba(0,0,0,.5)}.section-title{font-size:1.2rem;color:var(--gold-color);border-bottom:2px solid var(--border-color);padding-bottom:10px;margin-top:20px;margin-bottom:15px;font-weight:700;font-family:DotGothic16,sans-serif}.section-title:first-child{margin-top:0}.form-group{margin-bottom:15px}.form-row{display:grid;grid-template-columns:1fr 1fr;gap:15px}label{display:block;margin-bottom:5px;font-size:.9rem;color:#ccc;letter-spacing:1px}input,select,textarea{width:100%;background:#111;border:1px solid #444;color:#fff;padding:10px;border-radius:2px;font-family:inherit;letter-spacing:2px}input:focus,select:focus{outline:0;border-color:var(--accent-color)}.slider-container{display:flex;align-items:center;gap:10px}input[type=range]{flex:1}.attr-input-group{display:grid;grid-template-columns:2fr 1fr 0.8fr;gap:10px;align-items:center;margin-bottom:8px;background:rgba(0,0,0,.2);padding:5px 10px;border-radius:4px}.attr-price{font-size:.85rem;color:var(--gold-color);text-align:right;font-family:'Press Start 2P',cursive}.preview-panel{position:sticky;top:20px}.price-card{background:linear-gradient(135deg,#2c0b38,#1a1a1a);border:2px solid var(--accent-color);padding:20px;text-align:center;margin-bottom:20px;border-radius:8px;box-shadow:0 0 15px rgba(168,85,247,.3)}.price-label{font-size:.9rem;color:#aaa}.price-container{display:flex;justify-content:center;align-items:baseline;gap:10px;margin:15px 0}.total-price{font-size:2.5rem;font-weight:700;color:var(--gold-color);text-shadow:0 2px 4px rgba(0,0,0,.5);font-family:'Press Start 2P',cursive}.currency{font-size:1.2rem;color:#fff;font-family:'Press Start 2P',cursive}.mc-tooltip{background-color:var(--mc-tooltip-bg);border:3px solid #2a002a;border-top-color:#2a002a;border-radius:4px;padding:12px;color:#fff;font-family:DotGothic16,sans-serif;line-height:1.5;box-shadow:0 5px 15px rgba(0,0,0,.5);min-height:300px;position:relative;font-size:18px;letter-spacing:1px}.mc-0{color:#000}.mc-1{color:#00a}.mc-2{color:#0a0}.mc-3{color:#0aa}.mc-4{color:#a00}.mc-5{color:#a0a}.mc-6{color:#fa0}.mc-7{color:#aaa}.mc-8{color:#555}.mc-9{color:#55f}.mc-a{color:#5f5}.mc-b{color:#5ff}.mc-c{color:#f55}.mc-d{color:#f5f}.mc-e{color:#ff5}.mc-f{color:#fff}.mc-l{font-weight:700}.mc-m{text-decoration:line-through}.mc-n{text-decoration:underline}.mc-o{font-style:italic}.action-btn{width:100%;padding:15px;margin-top:20px;background:var(--accent-color);color:#fff;border:none;font-weight:700;font-size:1.1rem;cursor:pointer;transition:all .2s;text-transform:uppercase;letter-spacing:1px;clip-path:polygon(5% 0,100% 0,100% 90%,95% 100%,0 100%,0 10%)}.action-btn:hover{background:#9333ea;transform:translateY(-2px)}.action-btn:active{transform:translateY(0)}@media (max-width:768px){.container{grid-template-columns:1fr}}</style></head><body><h1>记忆代理人 x 落花星雨</h1><div class="subtitle">专属武器定制终端 - 打造属于你的传说</div><div class="container"><div class="config-panel"><div style="background:#222;border:1px dashed #555;padding:15px;margin-bottom:20px;border-radius:4px"><div style="display:flex;justify-content:space-between;align-items:center;cursor:pointer" onclick="toggleUpgradePanel()"><span style="color:var(--accent-color);font-weight:700;display:flex;align-items:center"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:6px"><path d="M23 4v6h-6"></path><path d="M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg> 老客户升级 / 导入配置</span> <span id="upgradeToggleIcon">▼</span></div><div id="upgradeInputPanel" style="display:none;margin-top:10px"><textarea id="upgradeArea" rows="3" placeholder="请在此粘贴您之前的武器配置代码..." style="width:100%;background:#111;color:#aaa;border:1px solid #444;padding:5px;font-size:.8rem"></textarea> <button class="action-btn" style="padding:8px;font-size:.9rem;margin-top:5px" onclick="loadForUpgrade()">加载旧配置并升级</button><div id="upgradeMsg" style="font-size:.8rem;margin-top:5px"></div></div></div><div class="section-title">基础信息</div><div class="form-row"><div class="form-group"><label>玩家 ID (绑定者)</label> <input type="text" id="playerId" placeholder="输入你的游戏ID" oninput="updatePreview()"></div><div class="form-group"><label>武器类型 (材质ID)</label> <input type="text" id="itemMaterial" list="material_list" placeholder="输入材质英文名 (如 DIAMOND_SWORD)" oninput="updatePreview()" value="WOODEN_SWORD"><datalist id="material_list"><option value="WOODEN_SWORD">木剑</option><option value="IRON_SWORD">铁剑</option><option value="DIAMOND_SWORD">钻石剑</option><option value="NETHERITE_SWORD">下界合金剑</option><option value="BOW">弓</option><option value="CROSSBOW">弩</option><option value="TRIDENT">三叉戟</option><option value="SHIELD">盾牌</option><option value="DIAMOND_AXE">钻石斧</option><option value="LEATHER_HELMET">皮革帽子</option><option value="IRON_HELMET">铁头盔</option><option value="DIAMOND_HELMET">钻石头盔</option><option value="NETHERITE_HELMET">下界合金头盔</option><option value="LEATHER_CHESTPLATE">皮革外套</option><option value="IRON_CHESTPLATE">铁胸甲</option><option value="DIAMOND_CHESTPLATE">钻石胸甲</option><option value="NETHERITE_CHESTPLATE">下界合金胸甲</option><option value="LEATHER_LEGGINGS">皮革裤子</option><option value="IRON_LEGGINGS">铁护腿</option><option value="DIAMOND_LEGGINGS">钻石护腿</option><option value="NETHERITE_LEGGINGS">下界合金护腿</option><option value="LEATHER_BOOTS">皮革靴子</option><option value="IRON_BOOTS">铁靴子</option><option value="DIAMOND_BOOTS">钻石靴子</option><option value="NETHERITE_BOOTS">下界合金靴子</option></datalist></div></div><div class="form-row"><div class="form-group"><label>武器名称 (最多10字)</label> <input type="text" id="itemName" value="&c定制武器" maxlength="16" placeholder="最多10字 (含颜色代码限制16字符)" oninput="updatePreview()"></div><div class="form-group"><label>装备部位</label> <select id="itemSlot" onchange="updateVisibleAttributes()"><option value="主手">主手</option><option value="副手">副手</option><option value="头盔">头盔</option><option value="胸甲">胸甲</option><option value="护腿">护腿</option><option value="靴子">靴子</option></select></div></div><div class="form-group"><label>背景故事 (最多5行，每行15字)</label> <textarea id="itemLore" rows="5" placeholder="输入背景故事..." oninput="validateLore(this)">由记忆碎片凝结而成。</textarea></div><div id="attributes-container"></div></div><div class="preview-panel"><div class="price-card"><div class="price-label">定制预估价格</div><div class="price-container"><span class="total-price" id="totalPrice">0</span> <span class="currency">RMB</span></div></div><div class="mc-tooltip" id="tooltipPreview"></div><button class="action-btn" id="copyBtn" onclick="copyConfig()">复制配置代码</button><div style="text-align:center;margin-top:10px;font-size:.8rem;color:#666">复制后请发送给管理员进行实装</div><div id="adminPanel" style="margin-top:30px;border-top:2px dashed #444;padding-top:20px;display:none"><div class="section-title" style="font-size:1rem">管理员验证台</div><textarea id="importArea" rows="3" placeholder="在此粘贴玩家发来的 YAML 配置代码以验证价格..." style="font-size:.8rem;height:80px"></textarea> <button class="action-btn" style="background:#444;margin-top:10px;font-size:.9rem" onclick="verifyConfig()">验证并导入配置</button><div id="verifyResult" style="margin-top:10px;font-size:.9rem;font-weight:700;text-align:center"></div></div></div></div><script>const SECRET_SALT="MemoryAgent_Weapon_2026";let upgradeMode=!1,originalPrice=0;function toggleUpgradePanel(){const e=document.getElementById("upgradeInputPanel"),t=document.getElementById("upgradeToggleIcon");"none"===e.style.display?(e.style.display="block",t.innerText="▲"):(e.style.display="none",t.innerText="▼")}function loadForUpgrade(){const e=document.getElementById("upgradeArea").value,t=document.getElementById("upgradeMsg");if(!e)return void(t.innerHTML="<span style='color: #ef4444;'>请先粘贴配置代码！</span>");const o=e.match(/# 校验签名: (.+)/);if(o)try{const e=JSON.parse(decodeURIComponent(escape(atob(o[1]))));if(e.salt!==SECRET_SALT)throw new Error("Invalid Salt");if(document.getElementById("itemSlot").value=e.s,updateVisibleAttributes(),document.querySelectorAll("#attributes-container input").forEach(e=>e.value=""),e.a)for(const[t,o]of Object.entries(e.a)){const e=document.getElementById(t);e&&(e.value=o)}upgradeMode=!0,originalPrice=parseInt(e.p),t.innerHTML=`<span style='color: #22c55e;'><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: text-bottom; margin-right: 4px;"><polyline points="20 6 9 17 4 12"></polyline></svg> 加载成功！原价: ${originalPrice} RMB。请在下方修改属性，差价将自动计算。</span>`,updatePreview()}catch(e){console.error(e),t.innerHTML="<span style='color: #ef4444;'>配置解析失败，可能已被篡改！</span>"}else t.innerHTML="<span style='color: #ef4444;'>无效的配置：找不到签名，无法验证原价！</span>"}const urlParams=new URLSearchParams(window.location.search);"true"===urlParams.get("admin")&&(document.getElementById("adminPanel").style.display="block");let titleClickCount=0;function validateLore(e){let t=e.value.split("\n"),o=!1;t.length>5&&(t=t.slice(0,5),o=!0);for(let e=0;e<t.length;e++)t[e].length>15&&(t[e]=t[e].slice(0,15),o=!0);if(o){const o=e.selectionStart,l=e.selectionEnd;e.value=t.join("\n");try{e.setSelectionRange(o,l)}catch(e){}}updatePreview()}document.querySelector("h1").addEventListener("click",()=>{if(titleClickCount++,titleClickCount>=5){const e=document.getElementById("adminPanel");"none"===e.style.display?(e.style.display="block",alert("管理员验证台已开启")):e.style.display="none",titleClickCount=0}});const attributesDB={attack:[{id:"ap_attack",name:"伤害",color:"&a",costFactor:.02,isPercent:!1,limit:5e3,label:"伤害",allowed:["weapon"]},{id:"ap_pvp_attack",name:"PVP攻击",color:"&a",costFactor:.01,isPercent:!1,limit:5e3,label:"PVP攻击",allowed:["weapon"]},{id:"ap_pve_attack",name:"PVE攻击",color:"&a",costFactor:.01,isPercent:!1,limit:5e3,label:"PVE攻击",allowed:["weapon"]},{id:"ap_real_attack",name:"真实攻击",color:"&6",costFactor:.05,isPercent:!1,limit:5e3,label:"真实攻击",allowed:["weapon"]},{id:"ap_fire",name:"燃烧几率",color:"&6",costFactor:1,isPercent:!0,limit:50,label:"燃烧几率",allowed:["weapon"]},{id:"ap_fire_damage",name:"火焰攻击",color:"&6",costFactor:.01,isPercent:!1,limit:5e3,label:"火焰攻击",allowed:["weapon"]},{id:"ap_crit",name:"暴击几率",color:"&c",costFactor:1.5,isPercent:!0,limit:50,label:"暴击几率",allowed:["weapon"]},{id:"ap_crit_rate",name:"暴击倍率",color:"&c",costFactor:3,isPercent:!0,limit:100,label:"暴击倍率",allowed:["weapon"]},{id:"ap_vampire",name:"吸血几率",color:"&c",costFactor:3,isPercent:!0,limit:50,label:"吸血几率",allowed:["weapon"]},{id:"ap_vampire_rate",name:"吸血倍率",color:"&c",costFactor:1,isPercent:!0,limit:50,label:"吸血倍率",allowed:["weapon"]},{id:"ap_hit",name:"命中几率",color:"&3",costFactor:1,isPercent:!0,limit:50,label:"命中几率",allowed:["weapon"]},{id:"ap_frozen",name:"冰冻几率",color:"&3",costFactor:1,isPercent:!0,limit:50,label:"冰冻几率",allowed:["weapon"]},{id:"ap_frozen_intensity",name:"冰冻强度",color:"&3",costFactor:1,isPercent:!0,limit:50,label:"冰冻强度",allowed:["weapon"]},{id:"ap_lightning",name:"雷击几率",color:"&3",costFactor:1,isPercent:!0,limit:50,label:"雷击几率",allowed:["weapon"]},{id:"ap_lightning_damage",name:"雷电攻击",color:"&3",costFactor:.01,isPercent:!1,limit:5e3,label:"雷电攻击",allowed:["weapon"]},{id:"ap_sunder_armor",name:"破甲几率",color:"&3",costFactor:2,isPercent:!0,limit:50,label:"破甲几率",allowed:["weapon"]},{id:"ap_see_through",name:"护甲穿透",color:"&6",costFactor:5,isPercent:!0,limit:50,label:"护甲穿透",allowed:["weapon"]},{id:"ap_break_shield",name:"破盾几率",color:"&3",costFactor:1,isPercent:!0,limit:50,label:"破盾几率",allowed:["weapon"]}],defense:[{id:"ap_armor",name:"护甲值",color:"&a",costFactor:5,isPercent:!1,limit:100,label:"护甲值",allowed:["armor"]},{id:"ap_defense",name:"防御",color:"&a",costFactor:10,isPercent:!1,limit:50,label:"防御",allowed:["armor"]},{id:"ap_pvp_defense",name:"PVP减伤",color:"&a",costFactor:.02,isPercent:!1,limit:5e3,label:"PVP减伤",allowed:["armor"]},{id:"ap_pve_defense",name:"PVE减伤",color:"&a",costFactor:.02,isPercent:!1,limit:5e3,label:"PVE减伤",allowed:["armor"]},{id:"ap_crit_damage_resist",name:"暴伤抵抗",color:"&c",costFactor:1,isPercent:!0,limit:50,label:"暴伤抵抗",allowed:["armor"]},{id:"ap_crit_resist",name:"暴击抵抗",color:"&c",costFactor:1,isPercent:!0,limit:50,label:"暴击抵抗",allowed:["armor"]},{id:"ap_crit_dodge",name:"暴击闪避",color:"&c",costFactor:1,isPercent:!0,limit:50,label:"暴击闪避",allowed:["armor"]},{id:"ap_vampire_dodge",name:"吸血闪避",color:"&c",costFactor:1,isPercent:!0,limit:50,label:"吸血闪避",allowed:["armor"]},{id:"ap_vampire_resist",name:"吸血抵抗",color:"&c",costFactor:1,isPercent:!0,limit:50,label:"吸血抵抗",allowed:["armor"]},{id:"ap_reflection",name:"反弹几率",color:"&6",costFactor:2,isPercent:!0,limit:50,label:"反弹几率",allowed:["armor"]},{id:"ap_reflection_rate",name:"反弹倍率",color:"&6",costFactor:1,isPercent:!0,limit:50,label:"反弹倍率",allowed:["armor"]},{id:"ap_dodge",name:"闪避几率",color:"&6",costFactor:3,isPercent:!0,limit:50,label:"闪避几率",allowed:["armor"]},{id:"ap_shield_block",name:"盾牌格挡率",color:"&6",costFactor:1,isPercent:!0,limit:50,label:"盾牌格挡率",allowed:["armor"]},{id:"ap_remote_immune",name:"箭伤免疫率",color:"&6",costFactor:1,isPercent:!0,limit:50,label:"箭伤免疫率",allowed:["armor"]}],other:[{id:"ap_health",name:"生命力",color:"&a",costFactor:.02,isPercent:!1,limit:1e4,label:"生命力",allowed:["armor"]},{id:"ap_restore",name:"生命恢复",color:"&a",costFactor:.02,isPercent:!1,limit:1e3,label:"生命恢复",allowed:["armor"]},{id:"ap_restore_ratio",name:"百分比恢复",color:"&a",costFactor:10,isPercent:!0,limit:50,label:"百分比恢复",allowed:["armor"]},{id:"ap_accumulate_addition",name:"蓄力加成",color:"&6",costFactor:1,isPercent:!0,limit:50,label:"蓄力加成",allowed:["weapon"]},{id:"ap_accumulate_disturb",name:"蓄力干扰",color:"&6",costFactor:1,isPercent:!0,limit:50,label:"蓄力干扰",allowed:["weapon"]},{id:"ap_moving",name:"移速加成",color:"&6",costFactor:1,isPercent:!0,limit:50,label:"移速加成",allowed:["all"]},{id:"ap_exp_addition",name:"经验加成",color:"&6",costFactor:1,isPercent:!0,limit:300,label:"经验加成",allowed:["all"]},{id:"ap_shoot_speed",name:"弓箭射速",color:"&3",costFactor:1,isPercent:!0,limit:50,label:"弓箭射速",allowed:["weapon"]},{id:"ap_shoot_spread",name:"箭术精准",color:"&3",costFactor:1,isPercent:!0,limit:50,label:"箭术精准",allowed:["weapon"]},{id:"ap_shoot_through",name:"箭术穿透率",color:"&3",costFactor:1,isPercent:!0,limit:50,label:"箭术穿透率",allowed:["weapon"]}]};function init(){const e=document.getElementById("attributes-container"),t=(e,t)=>{let o=`<div class="section-title">${e}</div>`;return t.forEach(e=>{const t=e.isPercent?1:e.id.includes("attack")||e.id.includes("health")?10:1;e.isPercent,e.isPercent;o+=`\n                    <div class="attr-input-group">\n                        <label>${parseMcColor(e.color+e.name)}</label>\n                        <input type="number" \n                            id="${e.id}" \n                            data-is-percent="${e.isPercent}"\n                            data-cost="${e.costFactor}"\n                            data-limit="${e.limit}"\n                            data-mc-color="${e.color}"\n                            data-label="${e.label}"\n                            data-allowed='${JSON.stringify(e.allowed)}'\n                            placeholder="0" \n                            step="${t}"\n                            oninput="updatePreview()"\n                            min="0">\n                        <span id="price-${e.id}" class="attr-price"></span>\n                    </div>`}),o};e.innerHTML+=t("攻击属性 (仅限武器)",attributesDB.attack),e.innerHTML+=t("防御属性 (仅限装备栏)",attributesDB.defense),e.innerHTML+=t("特殊属性 (部分通用)",attributesDB.other),updateVisibleAttributes(),updatePreview()}function updateVisibleAttributes(){const e=document.getElementById("itemSlot").value;let t="weapon";["头盔","胸甲","护腿","靴子"].includes(e)&&(t="armor");document.querySelectorAll("#attributes-container input").forEach(e=>{let o=[];try{o=JSON.parse(e.dataset.allowed||"[]")}catch(e){console.error("JSON Parse error",e)}const l=e.closest(".attr-input-group");if(o.includes("all")||o.includes(t))l.style.display="grid";else{l.style.display="none",e.value="";const t=document.getElementById(`price-${e.id}`);t&&(t.innerText="",t.style.opacity="0")}}),updatePreview()}function calculatePrice(){let e=0;const t=document.getElementById("itemSlot").value;let o=1;"副手"===t&&(o=2);document.querySelectorAll("#attributes-container input").forEach(t=>{const l=t.closest(".attr-input-group");if(l&&"none"===l.style.display)return;let a=parseFloat(t.value),r=0;if(a&&a>0){const e=parseFloat(t.dataset.cost),l=parseFloat(t.dataset.limit);if(r=a*e,a>l){r+=r*((a-l)/l)*2}r*=o}const n=document.getElementById(`price-${t.id}`);n&&(r>0?(n.innerText=`+${Math.ceil(r)}`,n.style.opacity="1"):(n.innerText="",n.style.opacity="0")),e+=r});let l=Math.ceil(Math.max(e,50));if(upgradeMode){let e=l-originalPrice;return Math.max(e,0)}return l}function parseMcColor(e){if(!e)return"";let t="",o="",l=new Set;const a=e.split("&");a[0]&&(t+=a[0]);for(let e=1;e<a.length;e++){const r=a[e];if(0===r.length)continue;const n=r.charAt(0).toLowerCase(),i=r.substring(1);if("0123456789abcdef".includes(n)?(o=`mc-${n}`,l.clear()):"lmnok".includes(n)?l.add(`mc-${n}`):"r"===n&&(o="",l.clear()),i.length>0){let e=[];o&&e.push(o),l.forEach(t=>e.push(t)),e.length>0?t+=`<span class="${e.join(" ")}">${i}</span>`:t+=i}}return t}function updatePreview(){const e=calculatePrice();document.getElementById("totalPrice").innerText=e;const t=document.getElementById("itemName").value||"未命名武器",o=document.getElementById("itemSlot").value,l=document.getElementById("itemLore").value;document.getElementById("playerId").value;let a="";a+=parseMcColor(t+"&c[右键绑定]")+"<br><br>",a+=parseMcColor("&7&l&m----------&6&l武器描述&7&l&m---------")+"<br>",a+=parseMcColor("&0.")+"<br>",a+=parseMcColor("&e最上级<100%>&0............&e定制")+"<br>",a+=parseMcColor("&d可升级")+"<br>",a+=parseMcColor(`&e装备类型: ${o}`)+"<br>",a+=parseMcColor("&0.")+"<br>";let r=!1;const n=Array.from(document.querySelectorAll("#attributes-container input")),i=n.find(e=>"ap_attack"===e.id);i&&i.value>0&&(a+=parseMcColor(`&b&l伤害:&2&l +${i.value}`)+"<br>"),a+=parseMcColor("&7&l&m----------&6&l武器属性&7&l&m---------")+"<br>",n.forEach(e=>{const t=parseFloat(e.value);if(t>0&&"ap_attack"!==e.id){const o=e.dataset.label,l=e.dataset.mcColor,n="true"===e.dataset.isPercent;a+=parseMcColor(`${l}&l${o}:&2&l +${t}${n?"%":""}`)+"<br>",r=!0}}),r||i&&!(i.value<=0)||(a+=parseMcColor("&7(暂无附加属性)")+"<br>"),a+=parseMcColor("&7&l&m----------&6&l背景故事&7&l&m---------")+"<br>",a+=parseMcColor("&0.")+"<br>";l.split("\n").forEach(e=>{e.trim()&&(a+=parseMcColor(`&7&o${e}`)+"<br>")}),a+=parseMcColor("&0.")+"<br>",document.getElementById("tooltipPreview").innerHTML=a}function copyConfig(){const e=document.getElementById("playerId").value||"CustomItem",t=document.getElementById("itemMaterial").value,o=document.getElementById("itemName").value,l=document.getElementById("itemSlot").value,a=document.getElementById("itemLore").value,r=document.getElementById("totalPrice").innerText;let n=[];n.push(""),n.push("&7&l&m----------&6&l武器描述&7&l&m---------"),n.push("&0."),n.push("&e最上级<100%>&0............&e定制"),n.push("&d可升级"),n.push(`&e装备类型: ${l}`),n.push("&0.");const i=Array.from(document.querySelectorAll("#attributes-container input")),c={};i.forEach(e=>{const t=parseFloat(e.value),o=e.closest(".attr-input-group");t>0&&"none"!==o.style.display&&(c[e.id]=t)}),c.ap_attack&&n.push(`&b&l伤害:&2&l +${c.ap_attack}`),n.push("&7&l&m----------&6&l武器属性&7&l&m---------"),i.forEach(e=>{if(c[e.id]&&"ap_attack"!==e.id){const t=e.dataset.label,o=e.dataset.mcColor,l="true"===e.dataset.isPercent?"%":"";n.push(`${o}&l${t}:&2&l +${c[e.id]}${l}`)}}),n.push("&7&l&m----------&6&l背景故事&7&l&m---------"),n.push("&0."),a.split("\n").forEach(e=>{e.trim()&&n.push(`&7&o${e}`)}),n.push("&0.");const s={p:r,s:l,a:c,t:Date.now(),salt:SECRET_SALT},d=btoa(unescape(encodeURIComponent(JSON.stringify(s))));let m=upgradeMode?`# 玩家升级订单 - 补价: ${r} RMB (原价: ${originalPrice})\n`:`# 玩家定制订单 - 价格: ${r} RMB\n`;m+=`# 校验签名: ${d}\n`,m+=`${e}_Custom:\n`,m+=`  Id: ${t}\n`,m+="  Data: 0\n",m+=`  Display: '${o}§c[右键绑定]'\n`,m+="  Lore:\n",n.forEach(e=>{m+=`    - '${e}'\n`}),m+="  Options:\n",m+="    Unbreakable: true\n",m+="    HideFlags: true\n",navigator.clipboard.writeText(m).then(()=>{const e=document.getElementById("copyBtn"),t=e.innerText;e.innerText="已复制到剪贴板！",e.style.background="#22c55e",setTimeout(()=>{e.innerText=t,e.style.background=""},2e3)})}function verifyConfig(){const e=document.getElementById("importArea").value,t=document.getElementById("verifyResult");if(!e)return t.innerText="请先粘贴 YAML 配置代码！",void(t.style.color="#ef4444");const o=e.match(/# 校验签名: (.+)/);if(o)try{const e=JSON.parse(decodeURIComponent(escape(atob(o[1]))));if(e.salt!==SECRET_SALT)throw new Error("Invalid Salt");if(document.getElementById("itemSlot").value=e.s,updateVisibleAttributes(),document.querySelectorAll("#attributes-container input").forEach(e=>e.value=""),e.a)for(const[t,o]of Object.entries(e.a)){const e=document.getElementById(t);e&&(e.value=o)}const l=calculatePrice();l==e.p?(t.innerHTML=`<span style='color: #22c55e;'><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: text-bottom; margin-right: 4px;"><polyline points="20 6 9 17 4 12"></polyline></svg> 验证通过！</span><br>原始价格: ${e.p} | 当前计算: ${l}<br>配置已导入界面，您可以检查属性是否正确。`,updatePreview()):(t.innerHTML=`<span style='color: #fbbf24;'><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: text-bottom; margin-right: 4px;"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg> 警告：价格不匹配！</span><br>签名价格: ${e.p} | 实际应付: ${l}<br>可能原因：玩家修改了属性、P图改了价格，或者您的计费规则已更新。`,updatePreview())}catch(e){console.error(e),t.innerHTML="<span style='color: #ef4444;'><svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='3' stroke-linecap='round' stroke-linejoin='round' style='vertical-align: text-bottom; margin-right: 4px;'><line x1='18' y1='6' x2='6' y2='18'></line><line x1='6' y1='6' x2='18' y2='18'></line></svg> 错误：签名解析失败，配置可能已损坏！</span>"}else t.innerHTML="<span style='color: #ef4444;'><svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='3' stroke-linecap='round' stroke-linejoin='round' style='vertical-align: text-bottom; margin-right: 4px;'><line x1='18' y1='6' x2='6' y2='18'></line><line x1='6' y1='6' x2='18' y2='18'></line></svg> 错误：未找到校验签名，可能是伪造或旧版本配置！</span>"}init()</script></body></html>